@model prjLookday.ViewModels.CActivityAlbumViewModel

<form id="createActivityForm" action="/Activity/Create" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()
    <div class="form-group">
        <div id="ActivityPicPreview" class="d-flex justify-content-center"></div>
    </div>
    <div class="form-group">
        <label for="Name">名稱</label>
        <input type="text" class="form-control" id="Name" name="Name" required />
    </div>
    <div class="form-group">
        <label for="Description">描述</label>
        <textarea class="form-control" id="Description" name="Description" required></textarea>
    </div>
    <div class="form-group">
        <label for="Price">價格</label>
        <input type="number" class="form-control" id="Price" name="Price" required />
    </div>
    <div class="form-group">
        <label for="Date">日期</label>
        <input type="date" class="form-control" id="Date" name="Date" required />
    </div>
    <div class="form-group">
        <label for="CityID">城市ID</label>
        <input type="number" class="form-control" id="CityID" name="CityID" required />
    </div>
    <div class="form-group">
        <label for="Remaining">人數</label>
        <input type="number" class="form-control" id="Remaining" name="Remaining" required />
    </div>
    <div class="form-group">
        <label for="HotelID">酒店ID</label>
        <input type="number" class="form-control" id="HotelID" name="HotelID" required />
    </div>
    <div class="form-group">
        <label for="PhotoFile">照片</label>
        <input type="file" class="form-control" id="PhotoFile" name="PhotoFile" accept="image/*" />
    </div>
    <br />
    <div class="form-group text-center">
        <button type="submit" class="btn btn-primary btn-sm">儲存</button> | 
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">取消</button>
    </div>
</form>

@section Scripts {
    <script>
        document.getElementById("PhotoFile").addEventListener('change', function (event) {
            var input = event.target;
            var preview = document.getElementById('ActivityPicPreview');
            preview.innerHTML = '';

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '150px';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(input.files[0]);
            }
        });

        document.getElementById('createActivityForm').addEventListener('submit', function (event) {
            event.preventDefault();
            var form = event.target;
            var formData = new FormData(form);

            fetch(form.action, {
                method: form.method,
                body: formData,
                headers: {
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                }
            }).then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        $('#createModal').modal('hide');
                        location.reload();
                    } else {
                        alert(data.message);
                    }
                }).catch(error => {
                    alert("發生錯誤: " + error.message);
                });
        });
    </script>
}
