@model IEnumerable<prjLookday.ViewModels.CActivityModelViewModel>

<div class="modal-body">
    @foreach (var mod in Model)
    {
        <div class="model-item mb-3 p-3 border rounded" style="border-color: orange; border-width: 2px;">
            <h5>@mod.ModelName</h5>
            <p><strong>價格:</strong> @($"${mod.ModelPrice:N0}")</p>
            <p><strong>日期:</strong> @mod.ModelDate</p>
            <p><strong>內容:</strong> @mod.ModelContent</p>
        </div>
    }

    <!-- Add new model form -->
    <hr />
    <h4>新增方案包</h4>
    <form id="addModelForm">
        <div class="form-group">
            <label for="ModelName">名稱</label>
            <input type="text" class="form-control" id="ModelName" name="ModelName" required />
        </div>
        <div class="form-group">
            <label for="ModelPrice">價格</label>
            <input type="number" step="0.01" class="form-control" id="ModelPrice" name="ModelPrice" required />
        </div>
        <div class="form-group">
            <label for="ModelDate">日期</label>
            <input type="date" class="form-control" id="ModelDate" name="ModelDate" required />
        </div>
        <div class="form-group">
            <label for="ModelContent">內容</label>
            <textarea class="form-control" id="ModelContent" name="ModelContent" rows="3" required></textarea>
        </div>
        <input type="hidden" id="ActivityId" name="ActivityId" value="@ViewBag.ActivityId" />
        <br />
        <button type="submit" class="btn btn-primary">新增</button>
    </form>
</div>

<script>
    $(document).ready(function () {
        $("#addModelForm").submit(function (event) {
            event.preventDefault();

            var formData = $(this).serialize();

            $.ajax({
                url: '@Url.Action("AddActivityModel", "Activity")',
                type: 'POST',
                data: formData,
                success: function (response) {
                    alert(response.message);
                    if (response.success) {
                        var activityId = $("#ActivityId").val();
                        $.ajax({
                            url: '@Url.Action("GetActivityModels", "Activity")',
                            type: 'GET',
                            data: { id: activityId },  // 添加活動 ID 作為參數
                            success: function (response) {
                                $("#activityModelsModalBody").html(response);
                            },
                            error: function () {
                                alert("重新載入活動模型失敗");
                            }
                        });
                    }
                },
                error: function (xhr, status, error) {
                    alert("新增過程中出錯: " + xhr.responseText);
                }
            });
        });
    });
</script>
