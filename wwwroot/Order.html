
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Dashboard - SB Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="~/css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

    <style>
        .custom-sidenav {
            background-color: rgb(225,223,218);
            color: #ee7415;
        }

        .nav-link {
            color: #5b5b5b;
        }

        .background-image {
            position: relative;
            z-index: 1; /* 確保內容在背景圖片之上 */
        }

            .background-image::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image: url('/images/mountain.jpg');
                background-size: cover;
                background-position: center;
                background-attachment: fixed;
                opacity: 0.5; /* 調整透明度 */
                z-index: -1; /* 確保背景圖片在內容之下 */
            }
    </style>
</head>
<body class="sb-nav-fixed background-image">
    <nav class="sb-topnav navbar navbar-expand navbar-light" style="background-color:rgb(225,223,218);"></nav>
 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="~/js/scripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
    <script src="~/assets/demo/chart-area-demo.js"></script>
    <script src="~/assets/demo/chart-bar-demo.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
    <script src="~/js/datatables-simple-demo.js"></script>






    <h1>訂單資訊</h1>
    <!--<form id="search<!--Form" style="text-align:right">
    </form>-->
    <div style="margin-left:800px;">
        <input type="text" id="inputsearch" placeholder="搜尋訂單編號或是用戶編號/名稱">
        <button type="submit" onclick="getBookingById()">搜尋</button>
        <button type="submit" id="allorders" onclick="allbookings()">全部訂單</button>
    </div>
    <table id="bookingsTable" border="1">
        <thead>
            <tr style="width:250px">
                <th>序號</th>
                <th>訂單編號</th>
                <th>訂單日期</th>
                <th>價錢</th>
                <th>客戶編號</th>
                <th>客戶姓名</th>
                <th>活動編號</th>
                <th>活動名稱</th>
                <th>訂單狀態</th>
                <th>總參與人數</th>
                <th>訂單編輯</th>
            </tr>
        </thead>
        <tbody>
            <tr id="loading-indicator">
                <td colspan="12"> loading........</td>
            </tr>
            <!-- 添加JavaScript的資料 -->
        </tbody>
    </table>

    <script>
        let bookingData = [];

        async function loadBookings() {
            const response = await fetch('/api/BookingOrder');
            const data = await response.json();
            bookingData = data;
            populateTable(bookingData);
            document.getElementById('loading-indicator').style.display = 'none';
        }

        function populateTable(data) {
            //getElementsByTagName會將 < tbody > 裡面的內容，丟進 tableBody 變數當中
            const tableBody = document.getElementById('bookingsTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = ''; // 清空原先資料
            const btncell = document.createElement("button");

            //console.log("dataaaaa", data)
            //if (!data.length) {
            //    tableBody.insertRow().insertCell = "dsdfdsafasd"
            //} else {
            data.forEach((data, index) => {
                const row = tableBody.insertRow();
                row.insertCell(0).innerHTML = index + 1;
                row.insertCell(1).innerText = data.bookingId;
                row.insertCell(2).innerText = new Date(data.bookingDate).toLocaleDateString(); //用于将日期对象转换为特定语言格式的日期字符串。它可以根据本地语言环境（Locale）来格式化日期，提供了一种简便的方法来显示用户友好的日期格式。
                row.insertCell(3).innerText = data.price;
                row.insertCell(4).innerText = data.userID;
                row.insertCell(5).innerText = data.userName;
                row.insertCell(6).innerText = data.activityID;
                row.insertCell(7).innerText = data.activityName;
                row.insertCell(8).innerText = data.bookingStatus;
                row.insertCell(9).innerText = data.member;


                const editcell = row.insertCell(10);


                const editlink = document.createElement('a');
                editlink.href = `/api/BookingOrder/${data.bookingId}`;
                editlink.innerHTML = '修改';
                editcell.appendChild(editlink);

                //const deletelink = document.createElement('a');
                //deletelink.href = `/api/BookingOrder/${data.bookingId}`;
                //deletelink.innerHTML = '刪除';
                //deletelink.onclick = function () {
                //    return confirm('確定要刪除嗎?');
                //};
                //deletelink.appendChild(deletelink);
            });


        };



        async function getBookingById() {
            const bookingId = document.getElementById('inputsearch').value;
            if (!bookingId) {
                alert("請輸入訂單編號");
                //populateTable(bookingData);
                return (populateTable(bookingData));
            }

            const response = await fetch(`/api/BookingOrder/${bookingId}`);
            if (!response.ok) {
                alert("找不到該訂單");
                return;
            }

            const data = await response.json();
            populateTable([data]);
        }

        //顯示全部訂單資料
        document.getElementById("allorders").addEventListener('click', () => {

            populateTable(bookingData);
        });


        //一載入頁面 就顯示資料
        window.onload = loadBookings;
        //document.addEventListener('DOMContentLoaded', loadBookings);




    </script>
</body>
</html>
